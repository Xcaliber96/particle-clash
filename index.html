<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Particle Clash</title>
  <style>
    html, body { 
      background: #232323; 
      margin: 0; 
      padding: 0;
      height: 100vh;
      overflow: hidden;
      touch-action: none;
      user-select: none;
      font-family: 'Courier New', monospace;
      position: fixed;
      width: 100%;
    }
    canvas { 
      display: block; 
      background: #1e1e24; 
      cursor: crosshair;
      position: absolute;
      top: 0;
      left: 0;
    }
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      pointer-events: none;
      z-index: 10;
    }
    #title { 
      text-align: center; 
      color: #fff; 
      font-size: 18px;
      font-weight: bold;
      margin: 10px 0 5px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    }
    #scoreboard {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      margin: 5px 0;
    }
    .score {
      font-size: 16px;
      font-weight: bold;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      padding: 8px 15px;
      border-radius: 8px;
      backdrop-filter: blur(5px);
      border: 2px solid;
    }
    #light-score {
      color: #fff8b4;
      background: rgba(240,240,200,0.1);
      border-color: rgba(240,240,200,0.3);
    }
    #dark-score {
      color: #4a5eff;
      background: rgba(65,78,155,0.1);
      border-color: rgba(65,78,155,0.3);
    }
    #controls {
      text-align: center;
      color: #aaa;
      font-size: 12px;
      margin-top: 5px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
      padding: 0 10px;
    }
    .center-divider {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 2px;
      height: 100vh;
      background: #484A52;
      z-index: 5;
    }
  </style>
</head>
<body>
<div class="center-divider"></div>
<div id="ui">
  <div id="title">Particle Clash</div>
  <div id="scoreboard">
    <div id="light-score" class="score">Light: <span id="light-count">0</span></div>
    <div id="dark-score" class="score">Dark: <span id="dark-count">0</span></div>
  </div>
  <div id="controls">Tap to add particles • Left = Light • Right = Dark</div>
</div>
<canvas id="game"></canvas>
<script>
let W, H;
const R = 6, N = 32; // Balanced particle count
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let particles = [];

// Mobile-optimized fullscreen setup
function resizeCanvas() {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W;
  canvas.height = H;
  canvas.style.width = W + 'px';
  canvas.style.height = H + 'px';
}

window.addEventListener('resize', resizeCanvas);
window.addEventListener('orientationchange', () => {
  setTimeout(resizeCanvas, 100);
});
resizeCanvas();

function updateScore() {
  const lightCount = particles.filter(p => p.side === "light").length;
  const darkCount = particles.filter(p => p.side === "dark").length;
  
  document.getElementById('light-count').textContent = lightCount;
  document.getElementById('dark-count').textContent = darkCount;
}

function spawn(side) {
  for (let i = 0; i < N; i++) {
    const x = side === "light" ? 30 : W - 30;
    const y = Math.random() * (H - 120) + 60;
    // BALANCED speed - not too fast, not too slow
    const vx = side === "light" ? 2.2 + Math.random() * 1.3 : -2.2 - Math.random() * 1.3;
    const vy = (Math.random() - 0.5) * 2.2;
    const color = side === "light" ? "#f0f0c8" : "#414e9b";
    particles.push({ x, y, vx, vy, color, side });
  }
}

// Balanced mobile touch handling
function addParticleBurst(x, y) {
  const side = x < W/2 ? "light" : "dark";
  const color = side === "light" ? "#f0f0c8" : "#414e9b";
  
  for(let i = 0; i < 8; i++) { // Moderate particle burst
    particles.push({
      x: x,
      y: y,
      // BALANCED burst speed
      vx: (Math.random()-0.5) * 8,
      vy: (Math.random()-0.5) * 8,
      color: color,
      side: side
    });
  }
}

// Better mobile event handling
canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const touch = e.touches[0];
  const x = touch.clientX - rect.left;
  const y = touch.clientY - rect.top;
  addParticleBurst(x, y);
}, { passive: false });

canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
}, { passive: false });

canvas.addEventListener('click', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  addParticleBurst(x, y);
});

canvas.addEventListener('contextmenu', (e) => e.preventDefault());

spawn("light"); spawn("dark");

function update() {
  for (const p of particles) { 
    p.x += p.vx; 
    p.y += p.vy; 
    
    // BALANCED friction - moderate slowdown
    p.vx *= 0.9996;
    p.vy *= 0.9996;
    
    // GENTLE random movement to maintain some energy
    p.vx += (Math.random() - 0.5) * 0.03;
    p.vy += (Math.random() - 0.5) * 0.03;
    
    // REASONABLE speed limit - good balance
    const speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
    if (speed > 4.5) {
      p.vx = (p.vx / speed) * 4.5;
      p.vy = (p.vy / speed) * 4.5;
    }
    
    // Gentle minimum speed boost
    if (speed < 0.3) {
      const angle = Math.random() * Math.PI * 2;
      p.vx += Math.cos(angle) * 0.3;
      p.vy += Math.sin(angle) * 0.3;
    }
    
    // Bounce off walls with moderate energy
    if (p.y <= R + 60 || p.y >= H - R - 20) {
      p.vy *= -0.85; // Moderate bouncing
      p.y = Math.max(R + 60, Math.min(H - R - 20, p.y));
    }
  }
  
  // Collision detection
  for (let i = particles.length - 1; i >= 0; i--) {
    for (let j = i - 1; j >= 0; j--) {
      let a = particles[i], b = particles[j];
      if (a && b && a.side !== b.side) {
        let dx = a.x - b.x, dy = a.y - b.y;
        let dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < R * 2) {
          // Moderate explosion effects
          for(let k = 0; k < 2; k++) {
            if (Math.random() < 0.6) {
              particles.push({
                x: (a.x + b.x) / 2,
                y: (a.y + b.y) / 2,
                vx: (Math.random()-0.5) * 4,
                vy: (Math.random()-0.5) * 4,
                color: "#ffffff",
                side: "neutral",
                life: 25
              });
            }
          }
          
          particles.splice(i, 1); 
          particles.splice(j, 1);
          i--; 
          break;
        }
      }
    }
  }
  
  // Clean up particles
  particles = particles.filter(p => {
    if (p.life !== undefined) {
      p.life--;
      return p.life > 0;
    }
    return p.x > -40 && p.x < W + 40 && p.y > 30 && p.y < H + 30;
  });
  
  // Maintain particle counts
  const lightCount = particles.filter(p => p.side === "light").length;
  const darkCount = particles.filter(p => p.side === "dark").length;
  
  if (lightCount < N/2.5) spawn("light");
  if (darkCount < N/2.5) spawn("dark");
  
  updateScore();
}

function draw() {
  ctx.clearRect(0, 0, W, H);
  
  // Draw particles
  for (const p of particles) {
    ctx.beginPath();
    ctx.arc(p.x, p.y, R, 0, 2 * Math.PI);
    ctx.fillStyle = p.color;
    ctx.fill();
  }
}

// Smooth animation loop
function loop() { 
  update(); 
  draw(); 
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
